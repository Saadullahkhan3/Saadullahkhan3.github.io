name: Minify and Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: write


jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 20

    - name: Install Dependencies
      run: |
        npm install -g html-minifier uglify-js cssnano-cli

    - name: Minify Code
      run: |
        mkdir dist
        html-minifier --input-dir ./ --output-dir ./dist --file-ext html --collapse-whitespace --remove-comments --minify-js --minify-css
        cssnano ./css/style.css ./dist/style.min.css
        cssnano ./css/image_hover.css ./dist/image_hover.min.css
        cssnano ./css/infinite_scroll.css ./dist/infinite_scroll.min.css
        cssnano ./css/hover_image_up.css ./dist/hover_image_up.min.css
        uglifyjs ./script.js --compress --mangle --output ./dist/script.min.js

    - name: Deploy to gh-pages
      uses: JamesIves/github-pages-deploy-action@4.1.0
      with:
        branch: gh-pages
        # folder: build
        


